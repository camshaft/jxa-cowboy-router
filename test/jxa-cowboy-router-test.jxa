(ns jxa-cowboy-router-test
  (require cowboy_req)
  (require random)
  (use (jxa-cowboy-router :only (get/2
                                 get/3
                                 post/3
                                 put/3
                                 delete/3
                                 all/3
                                 compile/1))))

;; ['case',
;;  {method,path},
;;  [{[binary,71,69,84],[list]},
;;   {[quote,ok],[quote,'microblog-res-root'],[list],[list],[quote,undefined]}],
;;  [{[binary,71,69,84],[list,[binary,117,115,101,114,115],id]},
;;   {[quote,ok],
;;    [quote,'microblog-res-users'],
;;    [list],
;;    [list,{[quote,id],id}],
;;    [quote,undefined]}],
;;  [{[binary,71,69,84],[[binary,114,101,115,116],'.',info]},
;;   {[quote,ok],[quote,'rest-resource'],[list],[list],info}],
;;  ['_',{[quote,error],[quote,notfound]}]]

(get "/" :microblog-res-root)
(get "/users" :microblog-res-users [])
(post "/users" :microblog-res-users [])
(get "/users/:id" :microblog-res-users [])
(put "/users/:id" :microblog-res-users [])
(delete "/users/:id" :microblog-res-users [])
(all "/handle-all" :handle-all [])
(get "/rest/[...]" :rest-resource)

(post "/roulette" (req bindings)
  (case (random/uniform 6)
    (1 {:dead []})
    (_ {:alive-for-now []})))

(compile jxa-cowboy-router-test)
