(ns jxa-cowboy-router-test
  (require cowboy_req)
  (require random)
  (require proplists)
  (require erlang)
  (use (jxa-cowboy-router :only (get/2
                                 get/3
                                 post/3
                                 put/3
                                 delete/3
                                 all/3
                                 compile/1))))

(get "/" :microblog-res-root)
(get "/users" :microblog-res-users [])
(post "/users" :microblog-res-users [])
(get "/users/:id" :microblog-res-users [])
(put "/users/:id" :microblog-res-users [])
(delete "/users/:id" :microblog-res-users [])
(all "/handle-all" :handle-all [])
(get "/rest/[...]" :rest-resource)
(get "/rest-path/:with/:var/[...]" :rest-resource)

;; TODO support optional segments
;; (get "/optional-1/[:value]" :optional-resource)
;; (get "/optional-2/[:first/:second]" :optional-resource)
;; (get "/optional-3/[:first/[:second]]" :optional-resource)

(post "/roulette" (req bindings)
  (case (random/uniform 6)
    (1 {:dead []})
    (_ {:alive-for-now []})))

(post "/roulette/:chance" (req bindings)
  (case (random/uniform
         (erlang/binary_to_integer
          (proplists/get_value :chance bindings)))
    (1 {:dead []})
    (_ {:alive-for-now []})))

(compile jxa-cowboy-router-test)
